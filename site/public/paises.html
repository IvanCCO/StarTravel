<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="shortcut icon" href="../public/Imagens/Logos/favicon.ico" type="image/x-icon">
</head>
<body>

    <div id="titulo">Where do wanna go?</div>

    <div class="main-paises">
        
        <div class="fileira1"> <!--O parametro this pega todos os elementos da div-->
            <div class="paises" id="holanda" onclick="ale(this)">Holand</div>
            <div class="paises" id="franca" onclick="ale(this)">France</div>
            <div class="paises" id="cuba" onclick="ale(this)">Cuba</div>
            <div class="paises" id="brazil" onclick="ale(this)">Brazil</div>
            <div class="paises" id="nigeria" onclick="ale(this)">Nigeria</div>
        </div>
        <div class="fileira2">
            <div class="paises" id="italia" onclick="ale(this)">Italy</div>
            <div class="paises" id="london" onclick="ale(this)">London</div>
            <div class="paises" id="novaYork" onclick="ale(this)">New York</div>
            <div class="paises" id="spain" onclick="ale(this)">Spain</div>
            <div class="paises" id="africa-sul" onclick="ale(this)">South Africa</div>
        </div>
    </div>

    <div id="btn">
        <b style="color: red;" id="msg_erro"></b>
        <a id="link"><button onclick="sel()">Go</button></a>
        <br>
    </div>
</body>
</html>

<script>

    var vetorPaises = [];

    

    function ale(elemento){

    

        if(elemento.className.indexOf('paisesSelecionados') > 0){

            elemento.className = 'paises';


            // Limpa o vetor pra ir pegando os valores que tem dentro e estão selecionados



            for(i = 0; i < vetorPaises.length; i++){

                if(vetorPaises[i] == elemento.textContent){

                    vetorPaises.splice(i, 1);   
                    console.log('Removendo:' + elemento.textContent)
                }
            }
        }else{

            elemento.className += " paisesSelecionados";
            // Adicionando ao vetor o nome dos Paises

            vetorPaises.push(elemento.textContent);
            console.log("Adicionando: " + elemento.textContent);
        }
    }

    function sel(){

        if(vetorPaises.length == 0){

            msg_erro.innerHTML = '<br>Choose 1 country at least';

        }else if(vetorPaises.length > 3){

            msg_erro.innerHTML = 'Maximum of 3 countries';

        }else {

            // Enviando o valor da nova input
            fetch("/usuarios/colocarPais", {
                method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                usernameServer: usernameVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);
            
            if (resposta.ok) {

                
                barra_loading.style.display = 'block';
                barra_loading.style.width = barra + '%';
                barra_loading.style.transition = 'width ease-in-out 2.5s'


                setTimeout(() => {
                    window.location = "paises.html";
                }, "3000")
                
                limparFormulario();

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
                erro.innerHTML = `Houve um erro no cadastro`;
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        setTimeout(() => {
    
                erro.innerHTML = '';
            }, 6000)
        
        return false;

        
    }
        }

    
    
</script>