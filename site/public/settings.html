<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarTravel/Settings</title>
    <link rel="stylesheet" href="./home.css">
</head>
<body>


    <div class="navBar" style="margin-left: 10vw;">
        <ul>
            <div id="logo-img"></div>
            <a href="home.html"><li>Home</li></a>
            <a href="dashboard.html"><li>Places</li></a>
            <a href="settings.html"><li>Settings</li></a>
            <li style="border: 0;"><button>Share</button></li>
        </ul>

        <div id="username">
            <img src="./Imagens/Users/user-default.png">
            <span id="a_usuario"></span>
        </div>
    </div>

        <div class="settings-panel">

         <div class="tituloSettings">
            <p>Settings</p>
         </div>
         <div class="organizar">

            <div class="inputs">

                <p>Change Username</p>
                <input type="text" class="inp_change" id="userPlaceholder" placeholder="">

                <p>Change Password</p> 
                <input type="text" class="inp_change" id="userPassword" placeholder="****" disabled="disabled">

                <p>Change Email</p> 
                <input type="text" class="inp_change" id="userEmail" placeholder="" disabled="disabled">

                

                </div>

                <div class="countries">

                    <p>Select your country</p>
                    <select class="inp_change" id="sel_changeLocation">
                        <option value="Sel">-- Select --</option>
                        <option value="Netherlands">Holand</option>
                        <option value="France">France</option>
                        <option value="Nigeria">Nigeria</option>
                        <option value="Cuba">Cuba</option>
                        <option value="Brazil">Brazil</option>
                        <option value="South Africa">South Africa</option>
                        <option value="Spain">Spain</option>
                        <option value="Italy">Italy</option>
                        <option value="London">London</option>
                        <option value="New York">New York</option>
                    </select>

                    <p>Rate The country</p> 
                    <input type="range" min="1" max="5" class="inp_change" onchange="exibirNumero()" id="text_change" style="margin-bottom: 3%;">
                    <span id="numValue" style="margin-bottom: 5%;"></span>
                    <button id="btn-vote" onclick="votar()">Vote</button>

                    <p>Disconnect</p>
                    <button onclick="leave()">Leave</button>
                   
                </div>
                
            </div>
            
            
            <div class="btn">
                <button onclick="updateconfig()">Save</button>
                <div style="color: white;" id="div_msg"></div>
            </div>
            
        </div>

</body>
</html>

<script>

    // Configurando PlaceHolder

    // Pegando as informações que estão no cache para mostrar pro usuario no placeholder


    // Colocando no meu placeholder os valores que do meu usuário 

    userPlaceholder.placeholder = sessionStorage.USERNAME_USUARIO;
    userEmail.placeholder = sessionStorage.EMAIL_USUARIO;
    idVar = sessionStorage.ID_USUARIO;
    a_usuario.innerHTML = userPlaceholder.placeholder;

    function leave(){

        // Colocar o display como bey user

        setTimeout(() =>{

            // Limpando o "Cache" que estava guardado no site
            sessionStorage.clear();

            window.location = 'index.html';
            alert('Bye')

        }, 300)
    }

    function updateconfig(){


        // Função para alterar a config
        var changeUserVar = userPlaceholder.value;
        var changePasswordVar = userPassword.value;
        var changeEmailVar = userEmail.value;
        var changeLocationVar = sel_changeLocation.value;
        var textChangeVar = text_change.value;


        if(changeEmailVar == '' && changeLocationVar == 'Sel' && changePasswordVar == '' && changeUserVar == '' && textChangeVar == ''){

            div_msg.innerHTML = `No changes were made`;


        }else if(changeUserVar != ''){

            fetch("/usuarios/alterar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usernameServer: changeUserVar,
                    idUsuarioServer: idVar,
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO updateconfig()!")
    
                if (resposta.ok) {
                    console.log(resposta);
                    div_msg.innerHTML = 'Changes will be available in your next login'
                    
                } else {
    
                    console.log("Houve um erro ao alterar os valores");
    
                    resposta.text().then(texto => {
                        console.error(texto);
                
                        setTimeout(() => {
    
                            div_msg.innerHTML = 'An error was occured. Try again later';
                        }, 4000)
                    });
                }
    
            }).catch(function (erro) {
                console.log(erro);
            })
    
            return false;
        }else{

            div_msg.innerHTML = `Sorry ${sessionStorage.USERNAME_USUARIO} you can't change those informations right now`
        }
    }

    function exibirNumero(){

        // Função para exibir o valor do meu range
        var range = text_change.value;

        console.log(range);

        numValue.innerHTML = `${range}`;
    }


    function votar(){

        var nomePais = sel_changeLocation.value;
     

        fetch("/usuarios/votar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usernameServer: changeUserVar,
                    idUsuarioServer: idVar,
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO Votar()!")
    
                if (resposta.ok) {
                    console.log(resposta);
                    div_msg.innerHTML = 'Vote Computed'
                    
                } else {
    
                    console.log("Houve um erro ao alterar os valores");
    
                    resposta.text().then(texto => {
                        console.error(texto);
                
                        setTimeout(() => {
    
                            div_msg.innerHTML = 'An error was occured. Try again later';
                        }, 4000)
                    });
                }
    
            }).catch(function (erro) {
                console.log(erro);
            })
    
            return false;
        }

</script>